plugins {
	id "java"
	id "application"
	id "idea"
	id "org.springframework.boot" version "2.6.3"
	id "io.spring.dependency-management" version "1.0.11.RELEASE"
	id "com.google.cloud.tools.jib" version "3.2.0"
	id "com.moowork.node" version "1.3.1"
}

group = "by.vk.betting.api"
version = "1.0.0-rc.1"

application {
	mainClass = "by.vk.betting.api.ServiceApplication"
	applicationName = "api"
}

bootJar {
	enabled = true
	archiveFileName = "application.jar"

	manifest {
		attributes 'provider': 'gradle'
	}
}

springBoot {
	buildInfo()
}

java {
	sourceCompatibility = JavaVersion.VERSION_17
	targetCompatibility = JavaVersion.VERSION_17
}

test {
	useJUnitPlatform()
}

node {
	version = "16.9.0"
	distBaseUrl = "https://nodejs.org/dist"
	download = false
	npmWorkDir = file("build/nodejs/")
	nodeModulesDir = file("frontend/")
}

task bundle(type: NpmTask, dependsOn: npmInstall) {
	args = ['run', 'build']
}

processResources.dependsOn bundle

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}

	implementation {
		exclude module: "spring-boot-starter-tomcat"
	}
}

repositories {
	mavenCentral()
}

ext {
	set("logbackVersion", "0.1.5")
}

dependencies {
	//region spring
	implementation("org.springframework.boot:spring-boot-starter-validation")
	implementation("org.springframework.boot:spring-boot-starter-undertow")
	implementation("org.springframework.boot:spring-boot-starter-web")
	implementation("org.springframework.boot:spring-boot-starter-actuator")
	implementation("org.springframework.boot:spring-boot-starter-webflux")
	//endregion

	//region logback
	implementation("ch.qos.logback.contrib:logback-json-classic:${logbackVersion}")
	implementation("ch.qos.logback.contrib:logback-jackson:${logbackVersion}")
	//endregion

	//region test
	testImplementation("org.springframework.boot:spring-boot-starter-test")
	//endregion
}
